# AI标注审查系统使用指南

## 系统概述

AI标注审查系统是一个专门用于可视化和审核AI标注数据的工具，支持视频片段(clips)和单帧图像(frames)的标注审核。

## 主要功能

### 1. 数据可视化
- **边界框显示**: 在视频/图像上显示标注的边界框
- **窗口帧标记**: 在视频中标记问题和答案的时间窗口
- **MOT追踪**: 支持MOTChallenge格式的追踪数据可视化

### 2. 交互式审核
- **标注浏览**: 逐个查看和审核标注
- **审核标记**: 标记标注的审核状态
- **数据保存**: 保存审核结果到原始JSON文件

### 3. 多媒体支持
- **视频播放**: 支持MP4等格式的视频播放控制
- **图像显示**: 支持JPG、PNG等格式的图像显示
- **实时标注**: 实时在媒体上显示相应的标注信息

## 系统要求

### 软件要求
- Python 3.7+
- OpenCV 4.5+
- Pillow 8.0+
- Tkinter (通常与Python一起安装)

### 硬件要求
- 显示器分辨率：1200x800或更高
- 内存：4GB以上推荐
- 存储：足够存放视频和图像数据的空间

## 安装和启动

### 1. 安装依赖
```bash
cd Checkdata
pip install -r requirements.txt
```

### 2. 启动系统
```bash
# 方法1: 使用Python直接启动
python main.py

# 方法2: 使用启动脚本
./run.sh
```

### 3. 验证安装
```bash
# 运行测试脚本
python test.py

# 运行功能演示
python demo.py
```

## 数据结构要求

### 目录结构
```
data/
├── Dateset/                    # 原始数据
│   ├── {sport}/
│   │   ├── {event}/
│   │   │   ├── clips/
│   │   │   │   ├── {id}.mp4    # 视频文件
│   │   │   │   └── ...
│   │   │   └── frames/
│   │   │       ├── {id}.jpg    # 图像文件
│   │   │       └── ...
│   │   └── ...
│   └── ...
├── output/                     # 标注数据
│   ├── {sport}/
│   │   ├── {event}/
│   │   │   ├── clips/
│   │   │   │   ├── {id}.json   # 视频标注
│   │   │   │   └── mot/        # MOT追踪文件
│   │   │   └── frames/
│   │   │       ├── {id}.json   # 图像标注
│   │   │       └── ...
│   │   └── ...
│   └── ...
└── Checkdata/                  # 审查程序
    ├── main.py
    ├── test.py
    ├── demo.py
    └── ...
```

### 标注格式

#### 视频标注 (clips)
```json
{
  "id": "1",
  "origin": {
    "sport": "3x3_Basketball",
    "event": "Men"
  },
  "annotations": [
    {
      "annotation_id": "1",
      "task_L1": "Understanding",
      "task_L2": "Spatial_Temporal_Grounding",
      "Q_window_frame": [0, 76],           // 问题时间窗口
      "A_window_frame": [11, 30],          // 答案时间窗口
      "first_bounding_box": [x1, y1, x2, y2],  // 第一帧边界框
      "tracking_bboxes": {                 // MOT追踪数据
        "mot_file": "path/to/mot/file.txt",
        "format": "MOTChallenge"
      },
      "reviewed": false                    // 审核状态
    }
  ]
}
```

#### 图像标注 (frames)
```json
{
  "id": "1",
  "origin": {
    "sport": "Cycling_Mountain_Bike",
    "event": "Women's_Cross-Country"
  },
  "annotations": [
    {
      "annotation_id": "1",
      "task_L1": "Understanding",
      "task_L2": "Objects_Spatial_Relationships",
      "timestamp_frame": 1,
      "bounding_box": [                    // 边界框列表
        {
          "label": "cyclist in black jersey",
          "box": [x1, y1, x2, y2]
        }
      ],
      "reviewed": false
    }
  ]
}
```

## 使用流程

### 1. 选择数据
1. 启动程序后，在左侧面板选择要审核的事件
2. 选择数据类型（clips或frames）
3. 选择具体的ID
4. 点击"加载数据"

### 2. 审核标注
1. 程序会加载对应的媒体文件和标注数据
2. 在右侧显示区域查看可视化结果
3. 在左侧面板查看标注详细信息
4. 使用"上一个"/"下一个"按钮浏览不同标注

### 3. 视频控制
- **播放/暂停**: 控制视频播放
- **重新播放**: 从窗口开始重新播放
- **进度条**: 手动调整播放位置
- **空格键**: 跳转到包含bbox的帧并暂停，再按一次恢复循环播放

### 4. 标记审核
1. 审核完成后点击"标记已审核"
2. 点击"保存"将审核状态写入JSON文件

## 可视化说明

### 边界框颜色
- **黄色**: 静态标注框 (bounding_box)
- **红色**: 第一帧追踪框 (first_bounding_box)
- **青色**: MOT追踪框 (tracking_bboxes)

### 窗口标记:
- **绿色"BEGIN"**: 时间窗口开始帧（大尺寸，带边框和闪烁效果）
- **红色"END"**: 时间窗口结束帧（大尺寸，带边框和闪烁效果）
- **标签**: Q(问题窗口)、A1/A2...(答案窗口)

## 快捷键操作

### 空格键功能
- **首次按下**: 跳转到当前标注中包含bbox的帧并暂停播放
- **再次按下**: 恢复循环播放
- **循环模式**: 按空格键会依次跳转到所有包含bbox的帧

**适用场景**: 
- 对于有边界框标注的视频，可以快速查看所有标注帧
- 包括first_bounding_box和MOT追踪数据中的所有帧
- 方便逐帧审核标注质量

### W键功能
- **首次按下**: 跳转到当前标注的第一个窗口帧（开始或结束）并暂停播放
- **再次按下**: 恢复循环播放
- **循环模式**: 按W键会按时间顺序依次跳转到所有窗口边界帧

**跳转顺序**: 
1. Q窗口开始帧 → Q窗口结束帧
2. A1窗口开始帧 → A1窗口结束帧  
3. A2窗口开始帧 → A2窗口结束帧
4. ... (依此类推)
5. 最后恢复循环播放

**适用场景**:
- 快速检查问题和答案窗口的时间边界
- 验证窗口标记的准确性
- 逐个审核多个答案窗口的时间范围

### 按键交互
- **互斥性**: 空格键和W键操作是互斥的，按一个键会重置另一个键的状态
- **状态重置**: 切换按键类型时会自动重置之前的暂停状态和索引位置
- **优先级**: 最后按下的键的功能生效

## 常见问题

### Q1: 程序启动后看不到任何事件
**A**: 检查数据路径是否正确，确保`../output`目录存在且包含标注数据。

### Q2: 视频无法播放
**A**: 检查视频文件是否存在，格式是否支持，确保OpenCV能正确打开该视频。

### Q3: 边界框显示不正确
**A**: 检查标注格式是否正确，边界框坐标是否在合理范围内。

### Q4: MOT文件无法加载
**A**: 确保MOT文件路径正确，格式符合MOTChallenge标准。

### Q5: 保存失败
**A**: 检查文件权限，确保程序有写入JSON文件的权限。

## 技术支持

如果遇到问题，请：
1. 运行`python test.py`检查系统状态
2. 运行`python demo.py`验证核心功能
3. 检查控制台输出的错误信息
4. 确认数据格式和路径是否正确

## 更新日志

### v1.0.0
- 初始版本发布
- 支持视频和图像标注审核
- 实现边界框和时间窗口可视化
- 支持MOT追踪数据显示
- 提供审核状态管理功能